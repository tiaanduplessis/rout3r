import t,{createContext as r}from"react";import{createBrowserHistory as e}from"history";import n from"wayfarer";var o=r(),i=o.Provider,a=o.Consumer,s=function(r){function o(o){var i=this;r.call(this,o),this.history=o.history||e(),this.unlisten=null,this.router=n(o.defaultPath||"/"),this.actions={push:this.history.push,goBack:this.history.goBack,goForward:this.history.goForward,replace:this.history.replace},t.Children.map(o.children,function(t){return i.addRoute(t)}),this.state={search:window.location.search,url:window.location.pathname}}return r&&(o.__proto__=r),(o.prototype=Object.create(r&&r.prototype)).constructor=o,o.prototype.componentDidMount=function(){var t=this;this.unlisten=this.history.listen(function(r){var e=r.pathname,n=r.search;t.setState(function(t){return Object.assign({},t,{url:e,search:n})})})},o.prototype.componentWillUnmount=function(){this.unlisten()},o.prototype.addRoute=function(r){this.router.on(r.props.path,function(e){return function(r,e){return t.createElement(a,null,function(n){var o,i=n.state,a=n.push,s=n.replace,c=n.goBack,u=n.goForward;return t.cloneElement(r,{path:i.url,searchParams:(o=i.search,void 0===o&&(o=""),o?(/^[?#]/.test(o)?o.slice(1):o).split("&").reduce(function(t,r){var e=r.split("="),n=e[1];return t[e[0]]=n?decodeURIComponent(n.replace(/\+/g," ")):"",t},{}):{}),push:a,replace:s,goBack:c,goForward:u,params:e})})}(r,e)})},o.prototype.render=function(){var r=this.state.url;return t.createElement(i,{value:Object.assign({},{state:this.state},this.actions)},this.router(r))},o}(t.Component);function c(r){var e=r.path,n=r.href,o=r.children,i=function(t,r){var e={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&-1===r.indexOf(n)&&(e[n]=t[n]);return e}(r,["path","href","children"]),s=n||e;return t.createElement(a,null,function(r){var e=r.push;return t.createElement("a",Object.assign({},i,{href:s,onClick:function(t){t.preventDefault(),e(s)}}),o)})}export{s as Router,c as Link};
